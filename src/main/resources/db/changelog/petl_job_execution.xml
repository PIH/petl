<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
		xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd">

	<changeSet id="petl_job_execution_1" author="PIH">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="petl_job_execution"/>
		</preConditions>
		<dropTable tableName="petl_job_execution"/>
	</changeSet>

	<changeSet id="petl_job_execution_2" author="PIH">
		<preConditions>
			<not><tableExists tableName="petl_job_execution" /></not>
		</preConditions>
		<comment>
			Create table to persist job execution history
		</comment>
		<createTable tableName="petl_job_execution">
			<column name="uuid" type="char(36)">
				<constraints nullable="false" />
			</column>
			<column name="job_path" type="varchar(1000)"/>
			<column name="parent_execution_uuid" type="char(36)" />
			<column name="description" type="varchar(1000)" />
			<column name="initiated" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="started" type="datetime"/>
			<column name="completed" type="datetime"/>
			<column name="status" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="error_message" type="varchar(1000)"/>
		</createTable>
	</changeSet>

</databaseChangeLog>
